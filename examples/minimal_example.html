<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>watasu - minimal example</title>
</head>
<body>
    
</body>

<script type="module">
  import Watasu from '../dist/watasu.js';
  
  const watasu = new Watasu();
  watasu.loadProgram(`
  set(sum, 0);
  inc(sum);
  print("current sum is ", sum);
  `);
  
  watasu.registerCall('set', function set(name, value) {
    if (name.name === 'dataReference') {
      this._context[name.value] = this.resolveParameterValue(value);
    } else {
      throw new Error('invalid set call');
    }
  })
  watasu.registerCall('inc', function inc(name) {
    if (name.name === 'dataReference') {
      this._context[name.value]++;
    } else {
      throw new Error('invalid inc call');
    }
  })
  watasu.registerCall('print', function print(...args) {
    console.log(...this.resolveParametersValues(args));
  })
  
  while(!watasu._runner.isDone) {
    watasu.step();
  }
</script>
</html>